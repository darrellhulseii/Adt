<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Way to Perfection - FF6 GBA Style RPG</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { background: #000; overflow: hidden; font-family: 'Courier New', monospace; color: #fff; }
        #container { position: relative; width: 100vw; height: 100vh; }
        canvas { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); image-rendering: pixelated; background: #000; }
        #controls { position: absolute; bottom: 0; left: 0; width: 100%; height: 280px; pointer-events: none; z-index: 10; }
        .btn { position: absolute; background: rgba(255,255,255,0.15); border: 3px solid rgba(255,255,255,0.4); border-radius: 50%; pointer-events: all; user-select: none; transition: all 0.1s; }
        .btn:active { background: rgba(255,255,255,0.5); transform: scale(0.95); }
        .dpad { width: 160px; height: 160px; }
        .dpad div { position: absolute; background: rgba(0,0,0,0.5); }
        .dpad .up { top: 0; left: 50px; width: 60px; height: 50px; border-radius: 25px 25px 10px 10px; }
        .dpad .down { bottom: 0; left: 50px; width: 60px; height: 50px; border-radius: 10px 10px 25px 25px; }
        .dpad .left { left: 0; top: 50px; width: 50px; height: 60px; border-radius: 25px 10px 10px 25px; }
        .dpad .right { right: 0; top: 50px; width: 50px; height: 60px; border-radius: 10px 25px 25px 10px; }
        .face { width: 100px; height: 100px; font-size: 55px; line-height: 100px; text-align: center; font-weight: bold; text-shadow: 2px 2px 4px #000; }
        .shoulder { width: 140px; height: 70px; border-radius: 35px; background: rgba(200,200,200,0.3); font-size: 24px; line-height: 70px; text-align: center; }
        .startselect { width: 80px; height: 45px; border-radius: 25px; background: rgba(255,100,100,0.4); font-size: 16px; line-height: 45px; text-align: center; }
        #pause-btn { position: absolute; top: 10px; left: 10px; padding: 10px 15px; background: #0056a0; color: #fff; border: none; border-radius: 8px; font-size: 14px; z-index: 20; pointer-events: all; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas" width="240" height="160"></canvas>
        <button id="pause-btn" onclick="togglePause()">⏸️ Menu</button>

        <audio id="bgm" loop>
            <source src="https://bitmidi.com/uploads/hans-zimmer-time.mid" type="audio/midi">
        </audio>

        <div id="controls">
            <!-- D-Pad -->
            <div class="dpad btn" style="left:40px; bottom:70px;">
                <div class="up" id="up"></div>
                <div class="down" id="down"></div>
                <div class="left" id="left"></div>
                <div class="right" id="right"></div>
            </div>

            <!-- Face Buttons (GBA) -->
            <div class="face btn" style="right:140px; bottom:160px;" id="y">Y</div>
            <div class="face btn" style="right:70px;  bottom:230px;" id="b">B</div>
            <div class="face btn" style="right:140px; bottom:300px;" id="a">A</div>
            <div class="face btn" style="right:210px; bottom:230px;" id="x">X</div>

            <!-- Shoulders -->
            <div class="shoulder btn" style="left:100px; top:20px;" id="l">L</div>
            <div class="shoulder btn" style="right:100px; top:20px;" id="r">R</div>

            <!-- Start / Select -->
            <div class="startselect btn" style="left:50%; margin-left:-120px; bottom:40px;" id="select">Select</div>
            <div class="startselect btn" style="left:50%; margin-left:40px; bottom:40px;" id="start">Start</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // Responsive scaling
        function resizeCanvas() {
            let scale = Math.min(window.innerWidth / 240, (window.innerHeight - 280) / 160);
            canvas.style.width = 240 * scale + 'px';
            canvas.style.height = 160 * scale + 'px';
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Music
        const bgm = document.getElementById('bgm');
        bgm.play().catch(() => console.log('Auto-play prevented; tap to start music'));

        const TILE_SIZE = 16;
        const WORLD_W = 128, WORLD_H = 128;

        // Assets
        const assets = {};
        function loadAssets() {
            const urls = {
                ff6_tiles: 'https://www.spriters-resource.com/resources/sheets/6/6707.png?updated=1489173881',
                cloud: 'https://www.spriters-resource.com/resources/sheets/172/175096.png?updated=1703697661',
                sora: 'https://www.spriters-resource.com/resources/sheets/23/23227.png?updated=1598857579',
                terra: 'https://www.spriters-resource.com/resources/sheets/6/6707.png?updated=1489173881',
                vivi: 'https://www.spriters-resource.com/resources/sheets/160/160684.png?updated=1724087719',
                tidus: 'https://www.spriters-resource.com/resources/sheets/172/17277.png?updated=1703697661',
                yuna: 'https://www.spriters-resource.com/resources/sheets/172/17277.png?updated=1703697661',
                drstrange: 'https://www.spriters-resource.com/resources/sheets/83/83835.png?updated=1587175412',
                fei: 'https://www.spriters-resource.com/resources/sheets/137/137001.png?updated=1596938275',
                bart: 'https://www.spriters-resource.com/resources/sheets/137/137004.png?updated=1596938275',
                wakka: 'https://www.spriters-resource.com/resources/sheets/173/17307.png?updated=1703697661',
                soldier: 'https://www.spriters-resource.com/resources/sheets/135/135858.png?updated=1595473359',
                slime: 'https://www.spriters-resource.com/resources/sheets/15/15880.png?updated=1595473359',
                shadow: 'https://www.spriters-resource.com/resources/sheets/17/17307.png?updated=1703697661',
                megaman: 'https://www.spriters-resource.com/resources/sheets/168/16879.png?updated=1703697661',
                shadowhedgehog: 'https://www.spriters-resource.com/resources/sheets/77/77460.png?updated=1703697661',
                starscream: 'https://www.spriters-resource.com/resources/sheets/162/162426.png?updated=1595473359',
                cactus: 'https://www.spriters-resource.com/resources/sheets/6/6707.png?updated=1489173881',
                anima: 'https://www.spriters-resource.com/resources/sheets/173/17307.png?updated=1703697661',
                wolverine: 'https://www.spriters-resource.com/resources/sheets/83/83835.png?updated=1587175412',
                rhino: 'https://www.spriters-resource.com/resources/sheets/21/217809.png?updated=1707181012',
                silversurfer: 'https://www.spriters-resource.com/resources/sheets/168/16879.png?updated=1703697661',
                superman: 'https://www.spriters-resource.com/resources/sheets/21/21781.png?updated=1707181012',
                lom_bg: 'https://www.creativeuncut.com/gallery-03/lom-domina.jpg'
            };
            for (let key in urls) {
                assets[key] = new Image();
                assets[key].src = urls[key];
            }
        }
        loadAssets();

        // Intro
        const introPages = [
            `CCC §1849: Sin is an offense against reason, truth, and right conscience; it is failure in genuine love for God and neighbor caused by a perverse attachment to certain goods. It wounds the nature of man and injures human solidarity. It has been defined as 'an utterance, a deed, or a desire contrary to the eternal law.'`,
            `CCC §1855: Mortal sin destroys charity in the heart of man by a grave violation of God's law; it turns man away from God, who is his ultimate end and his beatitude, by preferring an inferior good to him. Venial sin allows charity to subsist, even though it offends and wounds it.`,
            `Genesis 3: The serpent was more subtle than any other wild creature... So when the woman saw that the tree was good for food, and that it was a delight to the eyes, and that the tree was to be desired to make one wise, she took of its fruit and ate; and she also gave some to her husband, and he ate.`,
            `Revelation 21: Then I saw a new heaven and a new earth; for the first heaven and the first earth had passed away... He will wipe away every tear from their eyes, and death shall be no more, neither shall there be mourning nor crying nor pain any more, for the former things have passed away.`
        ];
        let introPage = 0;

        // Towns
        const towns = [
            {name:'Envyville', sin:'Envy', virtue:'Kindness', saint:'St. Philip Neri', npcs:['Superman','Batman','Wonder Woman'], boss:{name:'Legion', hp:350, atk:28, def:15, spd:12}},
            {name:'Greedtown', sin:'Greed', virtue:'Charity', saint:'St. Francis of Assisi', npcs:['Spider-Man','Iron Man','Captain America'], boss:{name:'Spoil', hp:450, atk:35, def:18, spd:14}},
            {name:'Sloth City', sin:'Sloth', virtue:'Diligence', saint:'St. Joseph', npcs:['Optimus Prime','Megatron','Bumblebee'], boss:{name:'Decepticon', hp:550, atk:40, def:22, spd:16}},
            {name:'Gluttonburg', sin:'Gluttony', virtue:'Temperance', saint:'St. Thomas Aquinas', npcs:['Sonic','Tails','Knuckles'], boss:{name:'Veterinarian', hp:650, atk:45, def:25, spd:13}},
            {name:'Lusthaven', sin:'Lust', virtue:'Chastity', saint:'St. Vincent Ferrer', npcs:['Pinhead','Chatterer'], boss:{name:'Cravings', hp:750, atk:50, def:28, spd:18}},
            {name:'Wrath', sin:'Wrath', virtue:'Patience', saint:'St. Stephen', npcs:['Edward Elric','Roy Mustang','Scar'], boss:{name:'Wrath', hp:850, atk:55, def:32, spd:20}},
            {name:'PrideTown', sin:'Pride', virtue:'Humility', saint:'St. John the Baptist', npcs:['Sephiroth illusion'], boss:{name:'Sephiroth', hp:1000, atk:65, def:35, spd:25}}
        ];

        const townPos = [[10,5],[20,15],[30,25],[40,35],[50,45],[15,40],[45,10]];

        let map = Array.from({length:WORLD_H},()=>Array(WORLD_W).fill(0));
        function genMap() {
            for(let y=0;y<WORLD_H;y++) for(let x=0;x<WORLD_W;x++) {
                let base = y<15?3:y<30?4:0;
                map[y][x] = base;
                if(Math.random()<0.08) map[y][x]=1;
                if(Math.random()<0.05 + y/200) map[y][x]=2;
            }
            townPos.forEach((p,i)=>map[p[1]][p[0]]=6);
        }
        genMap();

        let player = {x:30,y:30,px:30*TILE_SIZE,py:30*TILE_SIZE,moving:false, frame:0, dir:0};

        const STATES = {INTRO:0,OVERWORLD:1,TOWN:2,CHURCH:3,CONFESSION:4,BATTLE:5,MENU:6,DIALOG:7,POSTGAME:8,CREDITS:9};
        let state = STATES.INTRO;
        let curTown = 0, confessionStep = 0, creditLine = 0;

        // Party
        const partyBase = [
            {name:'Cloud', hp:200, mhp:200, mp:80, atk:40, def:30, spd:15, lvl:1, xp:0, next:100, special:'Omnislash'},
            {name:'Sora', hp:180, mhp:180, mp:100, atk:35, def:25, spd:20, lvl:1, xp:0, next:100, special:'Ragnarok'},
            {name:'Terra', hp:170, mhp:170, mp:120, atk:32, def:35, spd:16, lvl:1, xp:0, next:100, special:'Meltdown'}
        ];
        let party = JSON.parse(JSON.stringify(partyBase));
        let active = [0,1,2];

        let virtues = 0;

        // Battle
        let enemies = [], atb = [0,0,0,0], activeChar = -1, selectedCommand = 0, subSelected = 0;
        let battleAnim = {type:'', timer:0, dmg:0, x:0, y:0, frame:0};

        // Input
        const input = {
            up:false,down:false,left:false,right:false,
            a:false,b:false,x:false,y:false,
            l:false,r:false,
            start:false,select:false
        };

        function hold(btn) { input[btn] = true; }
        function release(btn) { input[btn] = false; }

        document.querySelectorAll('#up,#down,#left,#right,#a,#b,#x,#y,#l,#r,#start,#select').forEach(el => {
            el.addEventListener('touchstart', e => { e.preventDefault(); hold(el.id); });
            el.addEventListener('touchend', () => release(el.id));
        });

        function togglePause() { paused = !paused; state = paused ? STATES.PAUSE : state; }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            if (state === STATES.INTRO && input.a) {
                introPage++;
                if (introPage >= introPages.length) state = STATES.OVERWORLD;
            }

            if (state === STATES.OVERWORLD) {
                if (player.moving) return;
                let dx=0, dy=0;
                if (input.left) dx=-1;
                if (input.right) dx=1;
                if (input.up) dy=-1;
                if (input.down) dy=1;
                if (dx||dy) movePlayer(dx,dy);
                player.frame = (player.frame + 0.2) % 4;
                if (input.y) state = STATES.MENU;
            }

            if (state === STATES.TOWN) {
                if (input.a) {
                    if (Math.random()<0.5) state = STATES.CHURCH;
                    else startBattle(towns[curTown].boss);
                }
                if (input.b) state = STATES.OVERWORLD;
            }

            if (state === STATES.CHURCH) {
                if (input.a) state = STATES.CONFESSION;
                if (input.b) state = STATES.TOWN;
            }

            if (state === STATES.CONFESSION) {
                if (input.a) {
                    confessionStep++;
                    if (confessionStep >= confessionSteps.length) {
                        state = STATES.DIALOG;
                        currentDialog = 'Absolution granted. Go in peace.';
                        confessionStep = 0;
                    }
                }
            }

            if (state === STATES.BATTLE) updateBattle();

            if (state === STATES.POSTGAME) state = STATES.CREDITS;

            if (state === STATES.CREDITS) {
                if (input.a) creditLine++;
                if (creditLine >= credits.length) state = STATES.OVERWORLD;
            }
        }

        function movePlayer(dx,dy) {
            let nx = player.x + dx, ny = player.y + dy;
            if (nx<0||nx>=WORLD_W||ny<0||ny>=WORLD_H||map[ny][nx]===1) return;
            player.moving = true;
            let tx = nx*TILE_SIZE, ty = ny*TILE_SIZE;
            let step = 6;
            let int = setInterval(() => {
                player.px += dx*step;
                player.py += dy*step;
                if (Math.abs(tx-player.px)<step && Math.abs(ty-player.py)<step) {
                    player.px = tx; player.py = ty;
                    player.x = nx; player.y = ny;
                    player.moving = false;
                    clearInterval(int);
                    if (map[ny][nx]===2 && Math.random()<0.4) startBattle({name:'Monster',hp:200,atk:25,def:10,spd:10});
                    let tid = townPos.findIndex(p=>p[0]===nx&&p[1]===ny);
                    if (tid!==-1) { curTown=tid; state=STATES.TOWN; }
                }
            },16);
        }

        let enemies = [], atb = [0,0,0,0], activeChar = -1, selectedCommand = 0, subSelected = 0;
        const commands = ['Attack', 'Magic', 'Item', 'Defend'];
        let battleAnim = {type:'', timer:0, dmg:0, x:0, y:0, frame:0};

        function startBattle(boss) {
            state = STATES.BATTLE;
            enemies = [{...boss, curHp:boss.hp}];
            atb = [0,0,0,0];
            activeChar = -1;
            battleAnim = {type:'', timer:0, frame:0};
        }

        function updateBattle() {
            if (battleAnim.timer > 0) {
                battleAnim.timer--;
                battleAnim.frame = (battleAnim.frame + 0.2) % 3;
                return;
            }

            // ATB fill
            active.forEach((pIdx, i) => {
                let p = party[pIdx];
                if (p.hp > 0) atb[i] = Math.min(100, atb[i] + p.spd / 4);
            });
            enemies.forEach((e, i) => {
                if (e.curHp > 0) atb[3 + i] = Math.min(100, atb[3 + i] + e.spd / 5);
            });

            // Player ready
            if (activeChar === -1) {
                for (let i = 0; i < 3; i++) {
                    if (atb[i] >= 100 && party[active[i]].hp > 0) {
                        activeChar = i;
                        selectedCommand = 0;
                        subSelected = 0;
                        break;
                    }
                }
            }

            // Player input
            if (activeChar >= 0) {
                if (input.up) selectedCommand = (selectedCommand + commands.length - 1) % commands.length;
                if (input.down) selectedCommand = (selectedCommand + 1) % commands.length;
                if (input.left || input.right) subSelected = (subSelected + 1) % party[active[activeChar]].materia.length;
                if (input.a) {
                    let p = party[active[activeChar]];
                    let tgt = enemies.findIndex(e => e.curHp > 0);
                    let dmg = Math.max(1, p.atk - enemies[tgt].def / 2);
                    if (selectedCommand === 1 && p.mp >= 20) { dmg *= 1.5; p.mp -= 20; }
                    if (selectedCommand === 3) dmg /= 2; // Defend
                    enemies[tgt].curHp -= dmg;
                    battleAnim = {type:'slash', timer:40, dmg:dmg, x:160, y:40, frame:0};
                    atb[activeChar] = 0;
                    activeChar = -1;
                }
                if (input.b) {
                    atb[activeChar] = 99; // Cancel
                    activeChar = -1;
                }
            }

            // Enemy turn
            for (let i = 3; i < atb.length; i++) {
                if (atb[i] >= 100 && enemies[i-3].curHp > 0) {
                    let tgt = active.findIndex(pIdx => party[pIdx].hp > 0);
                    let dmg = Math.max(1, enemies[i-3].atk - party[active[tgt]].def / 2);
                    party[active[tgt]].hp -= dmg;
                    battleAnim = {type:'hit', timer:40, dmg:dmg, x:20, y:80, frame:0};
                    atb[i] = 0;
                }
            }

            if (enemies.every(e => e.curHp <= 0)) {
                virtues++;
                if (virtues === 7) state = STATES.POSTGAME;
                else state = STATES.TOWN;
            }
        }

        let currentDialog = '';
        const confessionSteps = [
            "Bless me, Father, for I have sinned.",
            "CCC §1451: Contrition is sorrow of the soul and detestation for the sin committed...",
            "I am sorry for these and all my sins.",
            "Priest: Your penance is to defeat the sin of this town.",
            "Act of Contrition: O my God, I am heartily sorry...",
            "Priest: I absolve you... Amen. (CCC §1468)"
        ];

        const credits = [
            "Victory! Sephiroth defeated.",
            "Jesus: 'You have overcome sin through repentance.'",
            "The Saints speak:",
            towns[0].saint + ": " + towns[0].quote,
            towns[1].saint + ": " + towns[1].quote,
            towns[2].saint + ": " + towns[2].quote,
            towns[3].saint + ": " + towns[3].quote,
            towns[4].saint + ": " + towns[4].quote,
            towns[5].saint + ": " + towns[5].quote,
            towns[6].saint + ": " + towns[6].quote,
            "All the Saints are in heaven thanks to Jesus and they encourage us all to meet them there through prayer, fasting, and much repentance.",
            "We use what other minds have made up to make them subject to Jesus Christ through this game.",
            "God bless you! Thank you for playing!"
        ];

        function draw() {
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,240,160);

            if (state === STATES.INTRO) {
                ctx.fillStyle = '#fff';
                ctx.font = '12px Courier New';
                let lines = introPages[introPage].split('\n');
                lines.forEach((l,i) => ctx.fillText(l,20,20 + i*15));
                ctx.fillText('A Confirm',20,140);
            } else if ([STATES.OVERWORLD,STATES.TOWN].includes(state)) {
                let camX = player.px - 120, camY = player.py - 80;
                for(let y=0;y<11;y++) for(let x=0;x<15;x++) {
                    let tx = Math.floor((camX + x*TILE_SIZE)/TILE_SIZE);
                    let ty = Math.floor((camY + y*TILE_SIZE)/TILE_SIZE);
                    if(tx<0||tx>=WORLD_W||ty<0||ty>=WORLD_H) ctx.fillStyle='#111';
                    else {
                        let t = map[ty][tx];
                        ctx.fillStyle = t===0?'#228B22':t===1?'#006400':t===2?'#8B4513':t===3?'#F0F8FF':t===4?'#808080':t===6?'#FFD700':'#444';
                    }
                    ctx.fillRect(x*TILE_SIZE,y*TILE_SIZE,TILE_SIZE,TILE_SIZE);
                }
                // Player
                if (assets.cloud.complete) {
                    let sx = Math.floor(player.frame) * 16;
                    let sy = player.dir * 24;
                    ctx.drawImage(assets.cloud, sx, sy, 16, 24, player.px - camX, player.py - camY, 16, 24);
                } else {
                    ctx.fillStyle = '#00BFFF';
                    ctx.fillRect(player.px - camX + 5, player.py - camY + 2, 6, 12);
                }
                if (state === STATES.TOWN) {
                    ctx.fillStyle = 'rgba(0,0,100,0.9)';
                    ctx.fillRect(20,20,200,120);
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Courier New';
                    ctx.fillText(towns[curTown].name,60,40);
                    ctx.fillText(`Sin: ${towns[curTown].sin}`,30,60);
                    ctx.fillText(`Virtue: ${towns[curTown].virtue}`,30,80);
                    ctx.fillText('A Church / Boss',30,100);
                }
            } else if (state === STATES.CHURCH) {
                ctx.fillStyle = 'rgba(255,255,255,0.9)';
                ctx.fillRect(20,20,200,120);
                ctx.fillStyle = '#000';
                ctx.font = '12px Courier New';
                ctx.fillText(`${towns[curTown].saint}`,30,40);
                ctx.fillText('A Confess',30,80);
            } else if (state === STATES.CONFESSION) {
                ctx.fillStyle = 'rgba(240,248,255,0.95)';
                ctx.fillRect(10,10,220,140);
                ctx.fillStyle = '#000';
                ctx.font = '10px Courier New';
                let lines = confessionSteps[confessionStep].split('\n');
                lines.forEach((l,i) => ctx.fillText(l,20,30 + i*15));
                ctx.fillText('A Continue',100,130);
            } else if (state === STATES.BATTLE) {
                ctx.fillStyle = '#222';
                ctx.fillRect(0,0,240,160);
                // ATB bars with animation
                atb.forEach((val, i) => {
                    ctx.fillStyle = '#00f';
                    ctx.fillRect(10 + i*50,140,val,8);
                });
                // Enemy
                if (assets.ff6_enemies.complete) {
                    ctx.drawImage(assets.ff6_enemies, 0, 0, 32, 32, 160, 40, 32, 32);
                } else {
                    ctx.fillStyle = '#f00';
                    ctx.fillRect(160,40,60,80);
                }
                if (battleAnim.type === 'slash' && battleAnim.timer > 0) {
                    ctx.strokeStyle = '#ff0';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(battleAnim.x, battleAnim.y);
                    ctx.lineTo(battleAnim.x + 50, battleAnim.y + 50);
                    ctx.stroke();
                    ctx.fillStyle = '#ff0';
                    ctx.font = '16px Courier New';
                    ctx.fillText('-' + battleAnim.dmg, battleAnim.x + 20, battleAnim.y + 20);
                }
                ctx.fillStyle = '#fff';
                ctx.font = '12px Courier New';
                ctx.fillText(enemies[0].name,170,30);
                ctx.fillText(`HP ${enemies[0].curHp}`,170,120);

                // Party
                if (assets.terra.complete) {
                    ctx.drawImage(assets.terra, Math.floor(battleAnim.frame) * 16, 0, 16, 24, 40, 80, 16, 24);
                } else {
                    ctx.fillStyle = '#00f';
                    ctx.fillRect(40,80,60,60);
                }
                ctx.fillStyle = '#fff';
                ctx.fillText(party[active[0]].name,50,70);
                ctx.fillText(`HP ${party[active[0]].hp}`,50,130);
                if (battleAnim.type === 'hit' && battleAnim.timer > 0) {
                    ctx.fillStyle = '#f88';
                    ctx.fillRect(battleAnim.x, battleAnim.y, 40, 10);
                    ctx.fillStyle = '#fff';
                    ctx.fillText('-' + battleAnim.dmg, battleAnim.x + 10, battleAnim.y + 10);
                }
                if (activeChar >= 0) {
                    ctx.fillStyle = 'rgba(0,0,0,0.8)';
                    ctx.fillRect(10,10,220,120);
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Courier New';
                    commands.forEach((cmd, j) => {
                        ctx.fillStyle = j === selectedCommand ? '#ff0' : '#fff';
                        ctx.fillText(cmd,20,30 + j*20);
                    });
                }
            } else if (state === STATES.POSTGAME) {
                state = STATES.CREDITS;
                creditLine = 0;
            } else if (state === STATES.CREDITS) {
                ctx.fillStyle = '#000';
                ctx.fillRect(0,0,240,160);
                ctx.fillStyle = '#ffd700';
                ctx.font = '12px Courier New';
                ctx.textAlign = 'center';
                if (creditLine < credits.length) {
                    ctx.fillText(credits[creditLine],120,80);
                } else {
                    ctx.fillText('THE END',120,80);
                }
                ctx.textAlign = 'left';
                ctx.fillStyle = '#fff';
                ctx.fillText('A Continue',100,140);
            }
        }

        gameLoop();
    </script>
</body>
</html>
